<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yahoo!ã‚«ãƒ¼ãƒŠãƒ“ ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.jsdelivr.net/npm/open-location-code@1.0.3/openlocationcode.min.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #1c1e21; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { max-width: 600px; width: 100%; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        h1 { font-size: 24px; text-align: center; margin-bottom: 20px; }
        label { font-weight: bold; font-size: 16px; display: block; margin-bottom: 5px; }
        input[type="text"], textarea { width: calc(100% - 22px); padding: 10px; border: 1px solid #dddfe2; border-radius: 6px; font-size: 16px; margin-bottom: 15px; }
        #result { margin-top: 20px; }
        #result_label { font-weight: bold; margin-bottom: 5px; display: block; }
        #result_link { width: 100%; box-sizing: border-box; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; background-color: #f8f8f8; }
        .memo-field { margin-top: 15px; }
        
        .main-actions { display: flex; gap: 10px; margin-top: 15px; }
        .main-actions button { flex: 1; padding: 12px; color: white; border: none; border-radius: 6px; font-size: 18px; font-weight: bold; cursor: pointer; transition: opacity 0.2s; }
        .main-actions button:hover { opacity: 0.9; }
        .generate-button { background-color: #0d6efd; }
        .reset-button { background-color: #6c757d; }

        #launchButton { display: block; width: 100%; box-sizing: border-box; margin-top: 10px; padding: 12px; border-radius: 6px; background-color: #0d6efd; color: white; text-decoration: none; text-align: center; font-size: 18px; font-weight: bold; transition: opacity 0.2s; }
        #launchButton:hover { opacity: 0.9; }
        .secondary-actions { display: flex; gap: 10px; margin-top: 10px; }
        .secondary-actions button { flex: 1; padding: 10px; font-size: 16px; border-radius: 6px; border: none; cursor: pointer; transition: opacity 0.2s; }
        .secondary-actions button:hover { opacity: 0.9; }
        .copy { background-color: #0dcaf0; color: #000; }
        .share { background-color: #198754; color: white; }

        /* --- ã“ã“ã‹ã‚‰ãŒæ–°ã—ã„èª¬æ˜æ–‡ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ --- */
        .rules-box {
            background-color: #e9f5ff;
            border: 1px solid #b3d7ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .rules-box h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #0056b3;
        }
        .rules-box ul {
            margin: 0;
            padding-left: 20px;
        }
        .rules-box li {
            margin-bottom: 5px;
        }
        /* --- ã“ã“ã¾ã§ãŒæ–°ã—ã„èª¬æ˜æ–‡ã®ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ --- */

    </style>
</head>
<body>
    <div class="container">
        <h1>Yahoo!ã‚«ãƒ¼ãƒŠãƒ“<br>ãƒªãƒ³ã‚¯ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>

        <div class="rules-box">
            <h4>ğŸ’¡ å…¥åŠ›ã®ãƒ’ãƒ³ãƒˆ</h4>
            <ul>
                <li><strong>Googleãƒãƒƒãƒ—ãƒªãƒ³ã‚¯:</strong> URLã«ç·¯åº¦çµŒåº¦ï¼ˆä¾‹: <code>@35.6,139.7</code>ï¼‰ãŒå«ã¾ã‚Œã‚‹å½¢å¼ã«ã®ã¿å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</li>
                <li><strong>çŸ­ç¸®URL:</strong> <code>goo.gl/maps/</code> ç­‰ã®çŸ­ã„ãƒªãƒ³ã‚¯ã¯ã€ä¸€åº¦ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã‹ã‚‰ã€è¡¨ç¤ºã•ã‚ŒãŸé•·ã„URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚</li>
                <li><strong>Plus Code:</strong> <code>8Q7XMP56+3H</code> ã®ã‚ˆã†ãªã€åœ°åã‚’å«ã¾ãªã„ã€Œãƒ•ãƒ«ã‚³ãƒ¼ãƒ‰ã€å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</li>
            </ul>
        </div>
        <div id="form-group">
            <label for="destination">ç›®çš„åœ° (å¿…é ˆ)</label>
            <input type="text" id="destination" placeholder="ãƒªãƒ³ã‚¯ ã¾ãŸã¯ Plus Code (ãƒ•ãƒ«ã‚³ãƒ¼ãƒ‰)">

            <label for="waypoints">çµŒç”±åœ° (ä»»æ„ã€3ã¤ã¾ã§)</label>
            <textarea id="waypoints" rows="3" placeholder="1è¡Œã«1ã¤ãšã¤å…¥åŠ›"></textarea>
        </div>
        
        <div class="main-actions">
            <button class="reset-button" onclick="resetForm()">ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="generate-button" onclick="generateLink()">ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆ</button>
        </div>

        <div id="result" style="display: none;">
            <label id="result_label" for="result_link">ç”Ÿæˆã•ã‚ŒãŸãƒªãƒ³ã‚¯ï¼š</label>
            <textarea id="result_link" readonly></textarea>
            
            <div class="memo-field">
                <label for="shareMemo">å…±æœ‰ãƒ¡ãƒ¢ (ä»»æ„)</label>
                <input type="text" id="shareMemo" placeholder="ä¾‹ï¼šã€‡ã€‡æ™‚ã«é›†åˆï¼">
            </div>

            <a id="launchButton" href="#" style="display: none;">ã‚¢ãƒ—ãƒªã‚’èµ·å‹•</a>
            <div class="secondary-actions">
                <button id="copyButton" class="copy">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
                <button id="shareButton" class="share" style="display: none;">å…±æœ‰ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // JavaScriptéƒ¨åˆ†ã¯å¤‰æ›´ã‚ã‚Šã¾ã›ã‚“
        function resetForm() {
            document.getElementById('destination').value = '';
            document.getElementById('waypoints').value = '';
            document.getElementById('shareMemo').value = '';
            document.getElementById('result').style.display = 'none';
        }

        function parseLocation(line) {
            line = line.trim();
            if (!line) return null;
            const gmapMatch = line.match(/@(-?\d+\.\d+),(-?\d+\.\d+)/);
            if (gmapMatch) { return { lat: gmapMatch[1], lon: gmapMatch[2] }; }
            try {
                if (OpenLocationCode.isFull(line)) {
                    const decoded = OpenLocationCode.decode(line);
                    return { lat: decoded.latitudeCenter, lon: decoded.longitudeCenter };
                }
            } catch (e) { return null; }
            alert("ã€Œ" + line + "ã€ã¯è§£æã§ããªã„å½¢å¼ã§ã™ã€‚Googleãƒãƒƒãƒ—ã®ãƒªãƒ³ã‚¯ã‹ã€Plus Codeã®ãƒ•ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
            return 'error';
        }

        function generateLink() {
            const destinationText = document.getElementById('destination').value.trim();
            const waypointsText = document.getElementById('waypoints').value.trim();
            if (!destinationText) { alert("ç›®çš„åœ°ã‚’å¿…ãšå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"); return; }
            const waypointLines = waypointsText ? waypointsText.split('\n').filter(line => line.trim() !== '') : [];
            const allLocationLines = [...waypointLines, destinationText];
            let coords = [];
            for (const line of allLocationLines) {
                const result = parseLocation(line);
                if (result === 'error') return;
                if (result) coords.push(result);
            }
            if (coords.length !== allLocationLines.length) return;
            let yahooNaviUrl = "yjcarnavi://navi/select?point=current";
            coords.forEach(coord => { yahooNaviUrl += `&point=${coord.lat},${coord.lon}`; });

            const resultDiv = document.getElementById('result');
            const resultLinkTextarea = document.getElementById('result_link');
            resultLinkTextarea.value = yahooNaviUrl;
            resultDiv.style.display = 'block';
            
            const launchButton = document.getElementById('launchButton');
            launchButton.href = yahooNaviUrl;
            launchButton.style.display = 'block';

            const copyButton = document.getElementById('copyButton');
            copyButton.textContent = 'ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼';
            copyButton.onclick = function() {
                const shareMemo = document.getElementById('shareMemo').value.trim();
                let textToCopy = yahooNaviUrl;
                if (shareMemo) {
                    textToCopy = shareMemo + '\n' + yahooNaviUrl;
                }
                navigator.clipboard.writeText(textToCopy).then(() => {
                    copyButton.textContent = 'ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                    setTimeout(() => { copyButton.textContent = 'ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼'; }, 2000);
                }, () => { alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); });
            };
            
            const shareButton = document.getElementById('shareButton');
            if (navigator.share) {
                shareButton.style.display = 'block';
                shareButton.onclick = function() {
                    const shareMemo = document.getElementById('shareMemo').value.trim();
                    let shareText = yahooNaviUrl;
                    if (shareMemo) {
                        shareText = shareMemo + '\n' + yahooNaviUrl;
                    }
                    navigator.share({
                        title: 'Yahoo!ã‚«ãƒ¼ãƒŠãƒ“ çµŒè·¯ãƒªãƒ³ã‚¯',
                        text: shareText,
                    })
                    .catch(error => console.log('å…±æœ‰ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ', error));
                };
            } else {
                shareButton.style.display = 'none';
            }
        }
    </script>
</body>
</html>
